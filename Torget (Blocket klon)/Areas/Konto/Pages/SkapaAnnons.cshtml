@page
@using Humanizer
@using Torget__Blocket_klon_.Pages.Shared
@model Torget__Blocket_klon_.Areas.Konto.Pages.SkapaAnnonsModel

<div class="ad-view">
    <div class="ad-input-area">
        <form method="post" enctype="multipart/form-data">
            @*Titel*@
            <div class="titel">
                <h2 class="titel"><i class="fa-solid fa-square-plus"></i> Ny annons</h2>
            </div>

            @*Rubrik*@
            <div class="rubrik">
                <input class="input-element" asp-for="Input.Titel" placeholder="Rubrik"/>
                <span asp-validation-for="Input.Titel"/>
            </div>

            @*Beskrivning*@
            <div class="beskrivning">
                <textarea class="input-element multiline-element" asp-for="Input.Beskrivning" placeholder="Beskrivning"></textarea>
                <span asp-validation-for="Input.Beskrivning"/>
            </div>

            @*Pris*@
            <div class="pris">
                <input class="input-element" asp-for="Input.Pris" placeholder="Pris"/>
                <span asp-validation-for="Input.Pris"/>
            </div>

            @*Kategori*@
            <div class="Kategori">

                <select class="form-select" name="Input.Kategori">
                    <option value="" disabled selected>Välj kategori</option>
                    @foreach (var category in Model.CategoryList)
                    {
                        <option value="@category">@category.ToLower().Humanize(LetterCasing.Title)</option>
                    }
                </select>
                <span asp-validation-for="Input.Kategori"></span>
            </div>

            @*Tags*@
            <div class="tags">
                <input id="tag-element" type="text" class="input-element" onchange="tagTextPillDecoration(this)" asp-for="Input.Tags" placeholder="Taggar"/>
            </div>

            <component type="typeof(TagInput)" render-mode="ServerPrerendered"/>


            @*Bild Prewview*@
            <div id="img-preview">
            </div>

            @*Bild*@
            <div class="Bild">
                <input class="form-control" ma type="file" onchange="ShowPreview(this)" asp-for="Input.AdImages" multiple max="4" accept=".jpg,.png,.jpeg*"/>
                <span asp-validation-for="Input.AdImages"/>

                <dialog class="image-modal">
                    <h4>Bild restriktioner</h4>
                    <p>Rekommenderad minsta bild storlek är 400x600px </p>
                    <p>Accepterade bildformat är:.jpg, .jpeg, .png</p>
                    <p>Max fyra bider</p>
                    <button type="button" class="close-btn">Close</button>
                </dialog>


            </div>

            @*Submit*@
            <div class="submit">

                <button type="button" class="modal-btn">i</button>

                <button class="submit-btn" type="submit">Lägg upp</button> @*BUG - submits on enter key*@
            </div>

        </form>
    </div>
</div>


<script>
  
    function ShowPreview(input) 
    {

        var imageContainer = document.getElementById("img-preview");
        imageContainer.innerHTML = "";
        imageContainer.style.display ="flex";

        var reader = new FileReader();

        function readFile(index) {
            if( index >= input.files.length ) return;
            
            var file = input.files[index];
            reader.onload = function(e) {

                var imageContainer = document.getElementById("img-preview");

                // get file content
                var bin = e.target.result;

                var image = document.createElement("img");
                image.src = bin;
                imageContainer.appendChild(image);

                readFile(index + 1);
            }
            reader.readAsDataURL(file);
        }
        readFile(0);
    }

    //#sourceURL=ShowPreview.js
    
       
    /*MODAL*/
    const modal = document.querySelector(".image-modal")
    const modal_btn = document.querySelector(".modal-btn")
    const close_modal_btn = document.querySelector(".close-btn")
   
    
    modal_btn.addEventListener("click", () => {
        modal.showModal();
    })  
    
    close_modal_btn.addEventListener("click", () => {
        modal.close();
    })
    
    
  

</script>